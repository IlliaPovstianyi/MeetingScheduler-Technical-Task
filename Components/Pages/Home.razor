@page "/"
@attribute [Authorize]
@rendermode InteractiveServer
@inject IUserService UserService

<PageTitle>Home</PageTitle>

<AuthorizeView>
    <Authorized>
        <div class="home-container">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="logo-section">
                    <img src="/images/scio-logo.png" alt="SCIO Logo" class="logo" />
                </div>
                <div class="profile-section">
                    <span class="profile-name">@CurrentUser?.FirstName @CurrentUser?.LastName</span>
                    @if (!string.IsNullOrEmpty(CurrentUser?.ProfilePictureUrl))
                    {
                        <img src="@CurrentUser.ProfilePictureUrl" alt="Profil" class="profile-avatar" />
                    }
                    else
                    {
                        <div class="profile-avatar-placeholder">
                            @CurrentUser?.FirstName?.FirstOrDefault()
                        </div>
                    }
                    <a href="/logout" class="logout-link" title="Odhlásit se">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </a>
                </div>
            </header>

            <!-- Main Content -->
            <main class="content-wrapper">
                <div class="welcome-section animate-appear">
                    <h1 class="welcome-text">Vítejte zpět!</h1>
                    <p class="subtitle-text">Spravujte své schůzky a sdílejte svůj kalendář</p>
                </div>

                <div class="cards-container">
                    <!-- Calendar Card -->
                    <div class="action-card animate-appear" style="animation-delay: 0.1s;">
                        <div class="card-emoji">📅</div>
                        <h2 class="card-title">Můj kalendář</h2>
                        <p class="card-description">Prohlédněte si své naplánované schůzky a spravujte svou dostupnost</p>
                        <button @onclick="ShowCalendar" class="card-btn">
                            Zobrazit kalendář
                        </button>
                    </div>

                    <!-- Share Link Card -->
                    <div class="action-card animate-appear" style="animation-delay: 0.2s;">
                        <div class="card-emoji">🔗</div>
                        <h2 class="card-title">Sdílet odkaz</h2>
                        <p class="card-description">Vygenerujte unikátní odkaz pro sjednání jednorázové schůzky</p>
                        <button class="card-btn">
                            Vygenerovat odkaz
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </Authorized>
</AuthorizeView>


@inject NavigationManager NavigationManager

@code {
    [CascadingParameter]
    private Task<AuthenticationState>? AuthenticationStateTask { get; set; }

    private User? CurrentUser { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (AuthenticationStateTask != null)
        {
            var authState = await AuthenticationStateTask;
            CurrentUser = await UserService.GetUserFromClaims(authState.User);
        }
    }

    private void ShowCalendar()
    {
        NavigationManager.NavigateTo("/calendar", forceLoad: true);
    }
}